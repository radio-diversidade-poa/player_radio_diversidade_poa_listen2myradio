<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Player Rádio Diversidade</title>

<link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400;700&display=swap" rel="stylesheet">

<style>
:root {
    --cor-fundo-caixinha: #26163b;
    --cor-botoes-player: #d4d4d4;
    --cor-texto-player: #ffffff;
    --cor-borda-player: #d4d4d4;
    --fonte-frase: 'Open Sans', sans-serif;
}

body {
    margin: 0;
    padding: 0;
}

.player-container {
    background-color: var(--cor-fundo-caixinha);
    color: var(--cor-texto-player);
    border: 2px solid var(--cor-borda-player);
    border-radius: 0.5rem;
    padding: 1rem;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    max-width: 100%;
    position: relative;
    padding-bottom: 80px; /* espaço para as barras */
}

.player-logo {
    background-image: url('https://raw.githubusercontent.com/radio-diversidade-poa/player_radio_diversidade_poa_listen2myradio/main/images/logo/logo_radio_250.png');
    background-size: cover;
    background-position: center;
    background-repeat: no-repeat;
    border-radius: 50%;
    width: 128px;
    height: 128px;
    margin-bottom: 1rem;
    margin-top: 1rem;
    display: block;
}

.player-phrase {
    font-family: var(--fonte-frase);
    width: 100%;
    text-align: center;
    font-weight: bold;
    font-size: 1.1rem;
    margin-bottom: 0.5rem;
}

.player-audio {
    width: 100%;
    z-index: 1;
    position: relative;
}

.player-audio::-webkit-media-controls-panel {
    background-color: transparent;
}

.player-audio::-webkit-media-controls-play-button,
.player-audio::-webkit-media-controls-mute-button,
.player-audio::-webkit-media-controls-volume-slider {
    background-color: var(--cor-botoes-player);
    border-radius: 0.25rem;
}

#audioVisualizer {
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 60px; /* altura da faixa de ondas */
}
</style>
</head>
<body>

<div class="player-container">
    <div class="player-logo"></div>
    
    <div class="player-phrase">
        <span>Clique e ouça!<br>Rádio Diversidade Poa</span>
    </div>
    
    <audio id="radioPlayer" autoplay controls class="player-audio" src="https://stm1.uniservstm.stream:6732/stream"></audio>

    <canvas id="audioVisualizer"></canvas>
</div>

<script>
const radioPlayer = document.getElementById('radioPlayer');

radioPlayer.addEventListener('ended', () => {
    setTimeout(() => {
        radioPlayer.load();
        radioPlayer.play().catch(e => console.error(e));
    }, 5000);
});
</script>

<script>
const canvas = document.getElementById('audioVisualizer');
const ctx = canvas.getContext('2d');

function resizeCanvas() {
    canvas.width = canvas.clientWidth;
    canvas.height = canvas.clientHeight;
}
window.addEventListener('resize', resizeCanvas);
resizeCanvas();

// Barrinhas pulsando
let hue = 260;
let bars = Array.from({length: 60}, () => Math.random() * canvas.height);
let animating = false;

function draw() {
    if (!animating) {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        return;
    }

    requestAnimationFrame(draw);
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const barWidth = canvas.width / bars.length;
    let x = 0;

    for (let i = 0; i < bars.length; i++) {
        bars[i] += (Math.random() - 0.5) * 5;
        if (bars[i] < 10) bars[i] = 10;
        if (bars[i] > canvas.height) bars[i] = canvas.height;

        ctx.fillStyle = (i % 2 === 0) 
            ? `hsl(${hue}, 80%, 60%)` 
            : `hsl(${hue + 60}, 80%, 60%)`;
        ctx.fillRect(x, canvas.height - bars[i], barWidth - 2, bars[i]);

        x += barWidth;
    }

    hue += 0.5;
    if (hue > 360) hue = 0;
}

radioPlayer.addEventListener('play', () => {
    animating = true;
    draw();
});

radioPlayer.addEventListener('pause', () => {
    animating = false;
    ctx.clearRect(0, 0, canvas.width, canvas.height);
});
</script>

</body>
</html>